<main class="grid-wrapper">

  <div class="preloader" ng-show="preloader.visible"></div>

  <reservation-finished>
    <section grid-row class="reservation-summary">

      <div class="actions">
        <div class="share">
          Share via:
          <a href="" title="Share on Facebook" target="_blank" class="icon-fb" fb-like="facebookShare.url"></a>
          <a href="" ng-href="https://twitter.com/intent/tweet?source={{shareURL}}&text={{shareURL}}&via=SuttonPlaceHtl" title="Tweet" target="_blank" class="icon-twitter"></a>
          <a href="" ng-href="https://plus.google.com/share?url={{shareURL}}" title="Share on Google+" target="_blank" class="icon-gplus"></a>
          <a href="" ng-href="mailto:?body={{shareURL}}" title="Email" target="_blank" class="icon-email"></a>
        </div>
        <div class="passbook">
          <a href="" class="button-print" ng-click="printPage()"><span>Print</span></a>
          <a href ng-click="sendToPassbook()"class="button-passbook"><span>Add to Passbook</span></a>
        </div>
      </div>

      <header>
        <h1>{{property.nameLong}}</h1>

        <div class="reference" ng-class="{'reference-visible': displayConfirmationNumber}">
          <p>Your reference:</p>
          <p><strong>{{reservationCode}}</strong></p>
        </div>

        <div class="booked">
          Booked: {{reservation.bookingDate | dateTime: 'D MMM YYYY'}}
        </div>
      </header>

      <div class="tables">
        <figure ng-switch="isEditable">
          <img ng-src="{{roomDetails.images[0].uri}}" alt="{{roomDetails.name}}">
          <!-- TODO: Add actions to buttons -->
          <button ng-switch-when="true" class="button" ng-click="modifyCurrentReservation()" ng-class="{disabled: reservation.canModify === false}" ng-if="!reservation.isInThePast">Modify</button>
          <button ng-switch-when="true" class="button-gray" ng-click="openCancelReservationDialog()" ng-class="{disabled: reservation.canModify === false}" ng-if="!reservation.isInThePast">Cancel</button>
        </figure>

        <div>
          <div>
            <h3>{{roomDetails.name}} <a href ng-click="openOtherRoomsDialog()" ng-if="reservation.rooms.length > 1">+ {{reservation.rooms.length - 1}} other <ng-pluralize count="reservation.rooms.length" when="{'2': 'room', 'other': 'rooms'}"> </ng-pluralize></a></h3>
            <h4>{{reservation.rooms[0].productName}}</h4>
          </div>

          <table class="data">
            <tbody>
              <tr>
                <th>Check in:</th>
                <td>{{reservation.arrivalDate | dateTime}}</td>
                <th>Adults:</th>
                <td>{{getCount('adults')}}</td>
              </tr>
              <tr>
                <th>Check out:</th>
                <td>{{reservation.departureDate | dateTime}}</td>
                <th>Children:</th>
                <td>{{getCount('children')}}</td>
              </tr>
            </tbody>
          </table>

          <table class="charges" ng-switch="!!reservation.pointValue">
            <tbody ng-switch-when="false">
              <tr>
                <th>Room Charges: {{billingDetails.paymentMethod}}</th>
                <td>{{getCount('price') | i18nCurrency: currencyCode}}</td>
                <th rowspan="3" class="total">Total:</th>
                <td rowspan="3" class="total-value">
                    <!--<a href ng-click="openPriceBreakdownInfo()">{{reservation.rooms[0].priceAfterTax | i18nCurrency: $root.currencyCode}}</a>-->
                    {{getCount('priceAfterTax') | i18nCurrency: $root.currencyCode}}
                </td>
              </tr>

              <!-- Additional taxes -->
              <tr ng-if="reservation.rooms[0].tax">
                <th>Taxes:</th>
                <td>{{getCount('tax') | i18nCurrency: $root.currencyCode}}</td>
              </tr>

              <!-- Discount -->
              <tr ng-if="reservation.rooms[0].priceBreakdown.discount">
                <th>Discount:</th>
                <td>{{reservation.rooms[0].priceBreakdown.discount | i18nCurrency: $root.currencyCode}}</td>
              </tr>
            </tbody>

            <tbody ng-switch-when="true">
              <tr>
                <th rowspan="3" class="total">Total:</th>
                <td rowspan="3" class="total-value">
                  <ng-pluralize count="reservation.pointValue" when="{'1': '{} point', 'other': '{} points'}"> </ng-pluralize>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <footer>
          <a href ng-click="openPoliciesInfo()">View Policies</a>
        </footer>
      </div>
    </section>

    <hr>

    <!-- AVAILABLE ADDONS -->
    <section grid-row class="reservation-enhance" ng-if="availableAddons.length">
      <h3>Enhance Your <strong>Stay With</strong></h3>
      <ul>
        <li class="{{ availableAddons < 3 ? 'half' : 'third' }}"
            ng-repeat="addon in availableAddons"
            ng-if="reservation.packages.indexOf(addon.code) === -1"
            ng-click="openAddonDetailDialog(null, addon)">
          <div ng-class="{'disabled': !addon.description || addon.description == ''}">
            <a class="eye-icon">
              <img ng-src="{{addon.images[0].uri}}" err-source="http://lorempixel.com/390/110/" />
            </a>

            <h4 ng-bind-html="addon.name | wrapWordHtml : 'span' : 0"></h4>

            <p>
              {{ addon._expanded ? addon.description : addon.descriptionShort }}
              <a
                ng-init="addon._expanded = false"
                ng-if="addon.description && addon.description != '' && addon.description !== addon.descriptionShort"
                ng-click="toggleAddonDescription($event, addon)">
                  {{ addon._expanded ? '[-]' : '[+]'}}
              </a>
            </p>

            <i>Add to your booking with one click:</i>

            <a class="button" ng-click="openAddonDetailDialog($event, addon, false)">{{addon.price | i18nCurrency: currencyCode}}</a>
            <a class="button"ng-if="addon.pointsRequired" ng-click="openAddonDetailDialog($event, addon, true)">{{addon.pointsRequired}} <small>points</small></a>
          </div>
        </li>
      </ul>

      <hr />
    </section>

    <section grid-row="">
      <hotel-location hotel-details="property"></hotel-location>
    </section>

    <hr ng-if="reservationAddons.length">

    <!-- RESERVATION ADDONS -->
    <section grid-row class="reservation-enhancements" ng-if="reservationAddons.length">
      <h3>Your Enhancements</h3>
      <list-items>
        <list-item ng-repeat="addon in reservationAddons">

          <figure>
            <img ng-src="{{addon.images[0].uri}}" err-source="http://lorempixel.com/390/110/" />
          </figure>

          <h2>{{addon.name}}</h2>

          <pricing-info>
            <p>
              <!-- When paid with cash -->
              <span class="value" ng-if="addon.price">
                {{addon.price | i18nCurrency: currencyCode}}
              </span>

              <!-- Paid with points -->
              <span class="value" ng-if="addon.points">
                <ng-pluralize count="addon.points" when="{'1': '{} point', 'other': '{} points'}"> </ng-pluralize>
              </span>
            </p>
          </pricing-info>

          <description-info>
            <p>{{ addon._expanded ? addon.description : addon.descriptionShort }}</p>
            <p>
              <a href
                ng-if="addon.hasViewMore"
                ng-click="addons[addonCode]._expanded = !addons[addonCode]._expanded">
                  {{ addon._expanded ? 'Show Less' : 'Show More' }}
              </a>
            </p>
          </description-info>

        </list-item>
      </list-items>
      <!-- PAID WITH CARD -->
      <p class="total" ng-if="getAddonsTotalPrice()">Total: {{getAddonsTotalPrice() | i18nCurrency: currencyCode}}</p>
      <!-- PAID WITH POINTS -->
      <p class="total" ng-if="getAddonsTotalPoints()">{{getAddonsTotalPrice()?'':'Total: '}}<ng-pluralize count="getAddonsTotalPoints()" when="{'1': '{} point', 'other': '{} points'}"> </ng-pluralize></p>
    </section>
  </reservation-finished>
</main>
