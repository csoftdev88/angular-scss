<h3 id="reservationBillingForm" ng-bind-html="'_reservation_page_billing_title_' | mainHeaderStyle"></h3>
<label id="form-errors" class="form-errors" ng-if="forms.billing.$invalid  && forms.billing.$submitted">
  <div>_missing_fields_message_</div>
  <div ng-if="!forms.billing.creditcard.$valid">_card_number_error_</div>
  <div ng-if="forms.billing.$submitted && !getCardExpirationDate()">_card_expiry_error_</div>
  <div ng-if="!forms.billing.cvv.$valid || forms.billing.cvv.$error.pattern">_card_cvv_error_</div>
</label>
<reservation-billing>
  <div ng-switch="billingDetails.paymentMethod">
    <ul class="payment-methods">
      <li ng-repeat="cardIcon in creditCardsIcons" ng-click="selectPaymentMethod('cc')">
        <i class="{{cardIcon}}" ng-class="{selected: getCreditCardDetails(billingDetails.card.number).icon === cardIcon}"></i>
      </li>
      <li class="divider" ng-if="loyaltyProgramEnabled"></li>
      <li ng-click="selectPaymentMethod('point')" ng-if="loyaltyProgramEnabled">
        <i class="points" ng-class="{selected: billingDetails.paymentMethod == 'point'}"></i>
      </li>
    </ul>
    <section class="payment-points" ng-switch-when="point">
      <!-- Points details only for logged in user -->
      <table ng-if="user.isLoggedIn()">
        <tr>
          <th>_current_points_</th>
          <td>{{pointsData.currentPoints}}</td>
        </tr>
        <tr>
          <th>_points_required_booking_</th>
          <td>-{{pointsData.pointsRequired}}</td>
        </tr>
        <tr>
          <th>_points_earned_booking_</th>
          <td class="earned">+{{pointsData.pointsEarned}}</td>
        </tr>
        <tr class="balance">
          <th>_balance_after_booking_</th>
          <td ng-class="{'not-enough': pointsData.pointsAfterBooking < 0}">{{pointsData.pointsAfterBooking}}</td>
        </tr>
      </table>

      <div ng-if="!user.isLoggedIn()">
        <registration-call>
          <h4>_feature_available_registered_</h4>
          <p>_click_here_to_ <a href ng-click="sso.login()">_login_register_</a>.</p>
        </registration-call>
      </div>

      <div class="error" ng-show="pointsData.pointsAfterBooking < 0">_not_enough_points_to_purchase_</div>

    </section>
    <section class="payment-card" ng-switch-default>
      <form name="forms.billing" novalidate ng-submit="forms.billing.$valid && continue()" ng-click="selectPaymentMethod('cc')" ng-class="{'ng-submitted': forms.billing.$submitted}">

        <label for="form-card-number">
          <input type="text" id="form-card-number" credit-card-check required
            placeholder="xxxx-xxxx-xxxx-xxxx"
            ng-model="billingDetails.card.number"
            name="creditcard"/>
          <span>
            <span ng-hide="forms.billing.$submitted && forms.billing.creditcard.$error.creditCardCheck">_card_number_label_</span>
            <span ng-show="forms.billing.$submitted && forms.billing.creditcard.$error.creditCardCheck">_card_number_error_</span>
          </span>
        </label>

        <label for="form-name-on-card">
          <input type="text" id="form-name-on-card" required
            placeholder="_card_name_placeholder_"
            ng-model="billingDetails.card.holderName" />
          <span>_card_name_label_</span>
        </label>

        <div class="card-details" ng-class="{invalid: forms.billing.$submitted && !getCardExpirationDate()}">
          <div class="expiry-title">
            <label>_card_expiry_label_ </label>
          </div>

          <div class="card-expiry">
            <!-- EXP MONTH -->
            <label for="form-expires-month" class="input-left">
              <select id="form-expires-month" name="form-expires-month"
                required ng-model="cardExpiration.selectedMonth"
                disable-search="true"
                chosen ng-options="month.name for month in cardExpiration.months"
                data-placeholder="_card_expiry_month_label_">
                <option></option>
              </select>
            </label>

            <!-- EXP YEAR -->
            <label for="form-expires-year" class="input-left">
              <select id="form-expires-year" name="form-expires-year"
                required ng-model="cardExpiration.selectedYear"
                disable-search="true" ng-change="onExpirationYearChange()"
                chosen ng-options="year for year in cardExpiration.years"
                data-placeholder="_card_expiry_year_label_">
                <option></option>
              </select>
            </label>
          </div>

          <div class="card-cvv">
            <label for="form-cvv">
              <input type="text" id="form-cvv" required
                placeholder="_card_cvv_placeholder_"
                ng-min="100"
                ng-max="999"
                ng-model="billingDetails.card.securityCode"
                ng-pattern="/^[0-9]{3,4}$/"
                name="cvv"/>
              <span>_card_cvv_label_</span>
            </label>
            <span class="help" ng-click="openCCVInfo()">?</span>
          </div>
        </div>

        <label for="form-guest-address" class="input-checkbox">
          <input type="checkbox" id="form-guest-address"
            ng-model="billingDetails.useGuestAddress" />
          _use_guest_address_label_
        </label>

        <div ng-if="!billingDetails.useGuestAddress">
          <label for="address">
            <input type="text" id="address" required
              placeholder="_address_placeholder_"
              ng-model="billingDetails.address" />
            <span>_address_label_</span>
          </label>

          <label for="city" class="input-left">
            <input type="text" id="city" required
              placeholder="_city_placeholder_"
              ng-model="billingDetails.city" />
            <span>_city_label_</span>
          </label>

          <label for="state" class="input-right">
            <input type="text" id="state" required
              placeholder="_state_placeholder_"
              ng-model="billingDetails.stateProvince" />
            <span>_state_label_</span>
          </label>

          <label for="country">
            <select type="text" id="country" required
              placeholder="_country_placeholder_"
              data-placeholder="_country_placeholder_"
              ng-model="billingDetails.country"
              chosen ng-options="country.title as country.title for country in iso.countries"
              chosen>
            </select>
            <span>_country_label_</span>
          </label>

          <label for="postal-code" class="input-left">
            <input type="text" id="postal-code" required
              placeholder="_postcode_placeholder_"
              ng-model="billingDetails.zip" />
            <span>_postcode_label_</span>
          </label>

          <label for="telephone" class="input-right">
            <input type="text" international-phone-number id="telephone" required
              placeholder="_phone_placeholder_" default-country="{{defaultCountryCode || 'ca'}}"
              preferred-countries="ca, us, gb"
              ng-model="billingDetails.phone"
              placeholder="Phone"/>
            <span>_phone_label_</span>
          </label>
        </div>

        <label class="form-errors" ng-if="forms.billing.$invalid  && forms.billing.$submitted">
          <div>_missing_fields_message_</div>
          <div ng-if="!forms.billing.creditcard.$valid">_card_number_error_</div>
          <div ng-if="forms.billing.$submitted && !getCardExpirationDate()">_card_expiry_error_</div>
          <div ng-if="!forms.billing.cvv.$valid || forms.billing.cvv.$error.pattern">_card_cvv_error_</div>
        </label>

        <input type="submit" id="submit" value="_submit_" ng-hide="true" />
      </form>
    </section>
  </div>
</reservation-billing>
