<hero-slider content="heroContent" ng-if="bookingConfig.displayHeroSlider" slide-width="uiConfig.heroSlider.slideWidth" slide-height="uiConfig.heroSlider.slideHeight"></hero-slider>
<!--<breadcrumbs stickable="main-header"></breadcrumbs>-->

<main class="grid-wrapper" ng-class="{'no-hero': !bookingConfig.displayHeroSlider}">

  <div class="preloader" ng-show="preloader.visible"></div>

  <section grid-row class="hotel-detail__header" ng-if="bookingConfig.headerPartial.display">

    <figure class="logo">
      <img ng-src="{{bookingConfig.headerPartial.logo.src}}" alt="{{bookingConfig.headerPartial.logo.alt}}">
    </figure>

    <div class="title-wrapper">
      <h1 class="title" ng-bind-html="'_your_booking_' | mainHeaderStyle" ng-if="!isCurrentBookingStep('reservation.confirmation')"></h1>
      <h1 class="title" ng-bind-html="'_your_confirmation_' | mainHeaderStyle" ng-if="isCurrentBookingStep('reservation.confirmation')"></h1>
    </div>

    <div class="contact-info">
      <div class="inner">
        <div class="icon">
          <i class="fa fa-phone"></i>
        </div>
        <div class="details">
          <div class="desc">_hotel_detail_header_contact_title_:</div>
          <div class="info">{{chain.contacts[0].tel}}</div>
        </div>
      </div>
    </div>

    <hr />
  </section>

  <nav grid-row id="reservation-steps" class="reservation-steps" ng-if="bookingConfig.bookingStepsNav.display && !bookingConfig.bookingStepsNav.showInReservationWidget">
    <h4 class="label">_your_booking_progress_</h4>
    <ul>
      <li><a class="button" href="" ng-click="goToRoom()">1<span class="dot">.</span> <span class="text">_choose_your_room_</span></a></li>
      <li ng-class="{'current': isCurrentBookingStep('reservation.details')}"><a class="button" href="" ng-click="goToBookingStep($event, 'reservation.details')">2<span class="dot">.</span> <span class="text">_guest_details_</span></a></li>
      <li ng-class="{'current': isCurrentBookingStep('reservation.billing')}"><a class="button" href="" ng-disabled="isBookingStepDisabled('reservation.billing')" ng-click="goToBookingStep($event, 'reservation.billing')">3<span class="dot">.</span> <span class="text">_billing_information_</span></a></li>
      <li ng-class="{'current': isCurrentBookingStep('reservation.confirmation')}"><a class="button" href="" ng-disabled="isBookingStepDisabled('reservation.confirmation')" ng-click="goToBookingStep($event, 'reservation.confirmation')">4<span class="dot">.</span> <span class="text">_confirm_your_reservation_</span></a></li>
    </ul>
  </nav>

  <reservation-widget grid-row>

    <span id="alert-warning" class="alert-warning" ng-if="invalidFormData.payment">
      <span>_payment_not_authorized_: </span>
    <span ng-if="invalidFormData.cardName">_payment_not_authorized_card_name_</span>
    <span ng-if="invalidFormData.paymentType">_payment_not_authorized_payment_type_</span>
    <span ng-if="invalidFormData.expiryDate">_payment_not_authorized_expiry_date_</span>
    <span ng-if="invalidFormData.ccExpired">_payment_not_authorized_cc_expired_</span>
    <span ng-if="invalidFormData.ccvInvalid">_payment_not_authorized_ccv_invalid_</span>
    <span ng-if="invalidFormData.ccNumberInvalid">_payment_not_authorized_cc_number_invalid_</span>
    </span>

    <span id="alert-warning" class="alert-warning" ng-if="invalidFormData.email">
      _user_already_registered_
    </span>

    <span id="alert-warning" class="alert-warning" ng-if="invalidFormData.generic">
      _generic_reservation_error_
    </span>


    <div grid-row>
      <!-- RESERVATION DETAILS -->
      <div grid="7">
        <nav grid-row id="reservation-steps" class="reservation-steps" ng-if="bookingConfig.bookingStepsNav.display && bookingConfig.bookingStepsNav.showInReservationWidget">
          <h4 class="label">_your_booking_progress_</h4>
          <ul>
            <li><a class="button" href="" ng-click="goToRoom()">1<span class="dot">.</span> <span class="text">_choose_your_room_</span></a></li>
            <li ng-class="{'current': isCurrentBookingStep('reservation.details')}"><a class="button" href="" ng-click="goToBookingStep($event, 'reservation.details')">2<span class="dot">.</span> <span class="text">_guest_details_</span></a></li>
            <li ng-class="{'current': isCurrentBookingStep('reservation.billing')}"><a class="button" href="" ng-disabled="isBookingStepDisabled('reservation.billing')" ng-click="goToBookingStep($event, 'reservation.billing')">3<span class="dot">.</span> <span class="text">_billing_information_</span></a></li>
            <li ng-class="{'current': isCurrentBookingStep('reservation.confirmation')}"><a class="button" href="" ng-disabled="isBookingStepDisabled('reservation.confirmation')" ng-click="goToBookingStep($event, 'reservation.confirmation')">4<span class="dot">.</span> <span class="text">_confirm_your_reservation_</span></a></li>
          </ul>
        </nav>
        <!-- SUBVIEWS -->
        <ui-view>
        </ui-view>
      </div>
      <aside grid="5">
        <section class="detail-links">
          <span ng-if="!bookingConfig.priceBreakdownExtended"><a href ng-click="openPriceBreakdownInfo()">_view_price_breakdown_</a> | </span><a href ng-click="readPolicies()">_policies_</a>
        </section>

        <section class="room-data">
          <h4>{{property.nameLong}}</h4>

          <div class="room-data-details">
            <span class="chain-logo"></span>
            <p class="desc" ng-bind-html="allRooms[0]._selectedProduct.name"></p>
            <p class="price"><strong>{{getProductPricePerNight(getTotal('totalBaseAfterPricingRules')) | i18nCurrency: currencyCode}}</strong> <em>_per_night_</em></p>
          </div>

          <h3>{{allRooms[0].name}} <a href ng-click="openOtherRoomsDialog()" ng-if="allRooms.length > 1">+ {{allRooms.length - 1}} _more_ <ng-pluralize count="allRooms.length" when="{'2': '_room_', 'other': '_rooms_'}"> </ng-pluralize></a></h3>

          <div class="image-wrapper" ng-if="allRooms[0].images[0].uri">
            <img ng-src="{{allRooms[0].images[0].uri | cloudinaryImage : 380 : 120 : 'fill'}}" alt="{{allRooms[0].name}}">
          </div>
          <div ng-if="!allRooms[0].images[0].uri" class="room-image-placeholder">
          </div>
        </section>

        <section class="reservation-data">
          <div class="data">
            <table>
              <tbody>
                <tr>
                  <th>_check_in_:</th>
                  <td>{{bookingDetails.from | dateTime}}</td>
                  <th>_adults_:</th>
                  <td>{{getGuestsCount('adults') || 0}}</td>
                </tr>
                <tr>
                  <th>_check_out_:</th>
                  <td>{{bookingDetails.to | dateTime}}</td>
                  <th>_children_:</th>
                  <td>{{getGuestsCount('children') || 0}}</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="charges" ng-class="{'extended': breakdownExtended}" ng-init="breakdownExtended = false">
            <table>
              <thead ng-switch="billingDetails.paymentMethod">
                <tr class="main">
                  <th>_room_charges_:</th>
                  <td ng-show="allRooms.length">{{getBreakdownTotalBaseAfterPricingRules() | i18nCurrency: currencyCode}}</td>
                </tr>

                <tr class="breakdown" ng-repeat="breakdown in allRooms[0]._selectedProduct.price.breakdowns | orderBy:'date'" ng-class="{'last': $last}">
                  <th>{{formatDate(breakdown.date, 'DD MMM YYYY')}}:</th>
                  <td>{{getBreakdownTotalDate(breakdown.date) | i18nCurrency: $root.currencyCode}}</td>
                </tr>

                <tr class="main">
                  <th>_taxes_:</th>
                  <!-- old tax number
                  <td>{{getBreakdown('totalTax') | i18nCurrency: $root.currencyCode}}</td>
                  -->
                  <td ng-show="allRooms.length">{{getBreakdownTotalTaxes(false) | i18nCurrency: $root.currencyCode}}</td>
                </tr>

                <tr class="breakdown" ng-repeat="taxItem in allRooms[0]._selectedProduct.price.taxDetails.policyTaxItemDetails" ng-class="{'last': $last}" ng-if="!taxItem.policyTaxItemIsFee">
                  <th>{{taxItem.policyTaxItem.policyTaxItemCode}}<span class="info" ng-if="taxItem.policyTaxItem.policyTaxItemDescription && taxItem.policyTaxItem.policyTaxItemDescription !== ''" tooltips tooltip-side="top" tooltip-template="{{taxItem.policyTaxItem.policyTaxItemDescription}}">?</span></th>
                  <td>{{getBreakdownTotalTax(taxItem.policyTaxItem.policyTaxItemCode) | i18nCurrency: $root.currencyCode}}</td>
                </tr>

                <tr class="main">
                  <th>_applicable_fees_:</th>
                  <td ng-show="allRooms.length">{{getBreakdownTotalTaxes(true) | i18nCurrency: $root.currencyCode}}</td>
                </tr>

                <tr class="breakdown" ng-repeat="taxItem in allRooms[0]._selectedProduct.price.feeDetails.policyTaxItemDetails" ng-class="{'last': $last}">
                  <th>{{taxItem.policyTaxItem.policyTaxItemCode}}<span class="info" ng-if="taxItem.policyTaxItem.policyTaxItemDescription && taxItem.policyTaxItem.policyTaxItemDescription !== ''" tooltips tooltip-side="top" tooltip-template="{{taxItem.policyTaxItem.policyTaxItemDescription}}">?</span></th>
                  <td>{{getBreakdownTotalFee(taxItem.policyTaxItem.policyTaxItemCode) | i18nCurrency: $root.currencyCode}}</td>
                </tr>

                <tr ng-if="getTotal('totalDiscount')">
                  <th>_discount_:</th>
                  <td>{{getTotal('totalDiscount') | i18nCurrency: $root.currencyCode}}</td>
                </tr>

                <tr class="main">
                  <th>_total_:</th>
                  <td ng-switch-when="cc">{{getTotal('totalAfterTaxAfterPricingRules') | i18nCurrency: $root.currencyCode}}</td>
                  <td ng-switch-when="point" ng-if="loyaltyProgramEnabled">{{getTotal('pointsRequired')}} _points_</td>
                  <td ng-switch-default>{{getTotal('totalAfterTaxAfterPricingRules') | i18nCurrency: $root.currencyCode}}<span ng-if="loyaltyProgramEnabled && canPayWithPoints"> _or_ {{getTotal('pointsRequired')}} _points_</span></td>
                </tr>
                <tr class="breakdown-toggle" ng-show="bookingConfig.priceBreakdownExtended">
                  <th></th>
                  <td><a href ng-click="breakdownExtended = !breakdownExtended"><span ng-if="!breakdownExtended">_view_price_breakdown_</span><span ng-if="breakdownExtended">_hide_price_breakdown_</span></a></td>
                </tr>
              </thead>
              <tbody>
                <!-- Additional taxes
                <tr ng-if="getTotal('totalAdditionalTaxes')">
                  <th>_taxes_:</th>
                  <td>{{getTotal('totalAfterTax') - getTotal('totalBaseAfterPricingRules') | i18nCurrency: $root.currencyCode}}</td>
                </tr>
                -->

                <!-- Additional fees
                <tr ng-if="getTotal('totalAdditionalFees')">
                  <th>_fees_:</th>
                  <td>{{getTotal('totalAdditionalFees') | i18nCurrency: $root.currencyCode}}</td>
                </tr>
                -->

              </tbody>
            </table>
          </div>

          <div ng-if="state.includes('reservation.confirmation')">
            <label for="agreement1" class="input-checkbox">
            <input type="checkbox" id="agreement1" ng-model="additionalInfo.agree"/>
            _i_agree_to_ <a href ng-click="readPolicies()">_terms_conditions_</a>
          </label>

            <label for="agreement2" class="input-checkbox">
            <input type="checkbox" id="agreement2" ng-model="additionalInfo.optedIn"/>
            _receive_offer_label_
          </label>
          </div>

          <div ng-if="bookingConfig.vouchers.enable && allRooms.length && !$stateParams.reservation" class="voucher-entry">
            <h4>_redeem_voucher_message_</h4>
            <label for="voucher" class=" medium">
              <input type="text" id="voucher"
                placeholder="_enter_voucher_label_"
                ng-model="voucher.code"
                ng-disabled="voucher.valid || voucher.verifying"
                ng-keypress="($event.which === 13)?redeemVoucher():0"
                name="voucher"
                ng-pattern="$root.generalValidationPattern"/>
              <img src="/static/images/preloader.gif" ng-hide="!voucher.verifying" />
              <button class="button" ng-click="redeemVoucher()" ng-disabled="!voucher.code || voucher.valid || voucher.verifying">_voucher_button_text_</button>
            </label>
            <div class="voucher-valid" ng-if="voucher.valid && voucher.submitted">
              <i class="fa fa-check"/><span> _voucher_code_valid_</span>
            </div>
            <div class="voucher-invalid" ng-if="!voucher.valid && voucher.submitted">
              <i class="fa fa-close"/><span> _voucher_code_invalid_</span>
            </div>
          </div>
        </section>
      </aside>
    </div>

    <label for="agreement3" class="input-checkbox" ng-show="state.includes('reservation.details') || state.includes('reservation.billing')">
      <input type="checkbox" id="agreement3" ng-model="additionalInfo.optedIn"/>
      <i ng-bind-html='"_email_optin_label_" | stringLocaleReplace:chainName'></i>
    </label>

    <div class="reservation-controls" grid-row>
      <button class="back" ng-click="goBack()">_back_</button>
      <button class="next" ng-click="continue()" ng-disabled="isContinueDisabled()">
        <span ng-if="continueName === 'continue'">_continue_</span>
        <span ng-if="continueName === 'confirm'">_confirm_</span>
      </button>
      <registration-call ng-if="!isUserLoggedIn() && state.includes('reservation.details') && !isModifyingAsAnonymous() && bookingConfig.loginCta.display">
        <h4 ng-bind-html="'_reservation_page_loginprompt_title_' | mainHeaderStyle"></h4>
        <p>_click_here_to_ <a href ng-click="sso.login()">_login_register_</a>.</p>
      </registration-call>
    </div>
  </reservation-widget>
</main>
