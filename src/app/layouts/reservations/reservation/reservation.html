<hero-slider content="heroContent" ng-if="bookingConfig.displayHeroSlider"></hero-slider>
<!--<breadcrumbs stickable="main-header"></breadcrumbs>-->

<main class="grid-wrapper" ng-class="{'no-hero': !bookingConfig.displayHeroSlider}">

  <div class="preloader" ng-show="preloader.visible"></div>

  <section grid-row class="hotel-detail__header" ng-if="bookingConfig.headerPartial.display">

    <figure class="logo">
      <img ng-src="{{bookingConfig.headerPartial.logo.src}}" alt="{{bookingConfig.headerPartial.logo.alt}}">
    </figure>

    <div class="title-wrapper">
      <h1 class="title" ng-bind-html="'_your_booking_' | mainHeaderStyle"></h1>
    </div>
    
    <div class="contact-info">
      <div class="inner">
        <div class="icon">
          <i class="fa fa-phone"></i>
        </div>
        <div class="details">
          <div class="desc">_hotel_detail_header_contact_title_:</div>
          <div class="info">{{chain.contacts[0].tel}}</div>
        </div>
      </div>
    </div>

    <hr />
  </section>

  <nav grid-row class="reservation-steps" ng-if="bookingConfig.bookingStepsNav.display">
    <h4 class="label">_your_booking_progress_</h4>
    <ul>
      <li><a class="button" href="" ui-sref="hotels">1. _choose_your_room_</a></li>
      <li><a class="button" href="" ng-class="{'current': isCurrentBookingStep('reservation.details')}" ng-click="goToBookingStep($event, 'reservation.details')">2. _guest_details_</a></li>
      <li><a class="button" href="" ng-class="{'current': isCurrentBookingStep('reservation.billing')}" ng-disabled="isBookingStepDisabled('reservation.billing')" ng-click="goToBookingStep($event, 'reservation.billing')">3. _billing_information_</a></li>
      <li><a class="button" href="" ng-class="{'current': isCurrentBookingStep('reservation.confirmation')}" ng-disabled="isBookingStepDisabled('reservation.confirmation')" ng-click="goToBookingStep($event, 'reservation.confirmation')">4. _confirm_your_reservation_</a></li>
    </ul>
  </nav>

  <reservation-widget grid-row>

    <span id="alert-warning" class="alert-warning" ng-if="invalidFormData.payment">
      <span>_payment_not_authorized_: </span>
      <span ng-if="invalidFormData.cardName">_payment_not_authorized_card_name_</span>
      <span ng-if="invalidFormData.paymentType">_payment_not_authorized_payment_type_</span>
      <span ng-if="invalidFormData.expiryDate">_payment_not_authorized_expiry_date_</span>
      <span ng-if="invalidFormData.ccExpired">_payment_not_authorized_cc_expired_</span>
      <span ng-if="invalidFormData.ccvInvalid">_payment_not_authorized_ccv_invalid_</span>
      <span ng-if="invalidFormData.ccNumberInvalid">_payment_not_authorized_cc_number_invalid_</span>
    </span>

    <span id="alert-warning" class="alert-warning" ng-if="invalidFormData.email">
      _user_already_registered_
    </span>

    <span id="alert-warning" class="alert-warning" ng-if="invalidFormData.generic">
      _generic_reservation_error_
    </span>

    
    <div grid-row>
      <!-- RESERVATION DETAILS -->
      <div grid="7">
        <!-- SUBVIEWS -->
        <ui-view>
        </ui-view>
      </div>
      <aside grid="5">
        <section class="detail-links">
          <span ng-if="!bookingConfig.priceBreakdownExtended"><a href ng-click="openPriceBreakdownInfo()">_view_price_breakdown_</a> | </span><a href ng-click="readPolicies()">_policies_</a>
        </section>

        <section class="room-data">
          <h4>{{property.nameLong}}</h4>

          <p class="desc" ng-bind-html="allRooms[0]._selectedProduct.name"></p>
          <p class="price"><strong>{{getProductPricePerNight(getTotal('totalBase')) | i18nCurrency: currencyCode}}</strong> <em>_per_night_</em></p>
          <h3>{{allRooms[0].name}} <a href ng-click="openOtherRoomsDialog()" ng-if="allRooms.length > 1">+ {{allRooms.length - 1}} _more_ <ng-pluralize count="allRooms.length" when="{'2': '_room_', 'other': '_rooms_'}"> </ng-pluralize></a></h3>

          <div class="image-wrapper">
            <img ng-src="{{allRooms[0].images[0].uri}}" alt="{{allRooms[0].name}}">
          </div>
        </section>

        <section class="reservation-data">
          <div class="data">
            <table>
              <tbody>
                <tr>
                  <th>_check_in_:</th>
                  <td>{{bookingDetails.from | dateTime}}</td>
                  <th>_adults_:</th>
                  <td>{{getGuestsCount('adults') || 0}}</td>
                </tr>
                <tr>
                  <th>_check_out_:</th>
                  <td>{{bookingDetails.to | dateTime}}</td>
                  <th>_children_:</th>
                  <td>{{getGuestsCount('children') || 0}}</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="charges" ng-class="{'extended': breakdownExtended}" ng-init="breakdownExtended = false">
            <table>
              <thead ng-switch="billingDetails.paymentMethod">
                <tr class="main">
                  <th>_room_charges_:</th>
                  <td>{{getTotal('totalBase') | i18nCurrency: currencyCode}}</td>
                </tr>

                <tr class="breakdown">
                  <th>23 Mar 2016:</th>
                  <td>$219</td>
                </tr>
                <tr class="breakdown last">
                  <th>24 Mar 2016:</th>
                  <td>$219</td>
                </tr>

                <tr class="main">
                  <th>_taxes_:</th>
                  <!-- old tax number
                  <td>{{getBreakdown('totalTax') | i18nCurrency: $root.currencyCode}}</td>
                  -->
                  <td>{{getTotal('totalAfterTax') - getTotal('totalBase') - getTotal('totalAdditionalFees') | i18nCurrency: $root.currencyCode}}</td>
                </tr>

                <tr class="breakdown">
                  <th>City:</th>
                  <td>$21</td>
                </tr>
                <tr class="breakdown last">
                  <th>Province:</th>
                  <td>$9</td>
                </tr>

                <tr class="main">
                  <th>_applicable_fees_:</th>
                  <td>{{getTotal('totalAdditionalFees') | i18nCurrency: $root.currencyCode}}</td>
                </tr>

                <tr class="breakdown">
                  <th>DMR:<span class="info" tooltips tooltip-side="{{isMobile ? 'left' : 'top'}}" tooltip-template="Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam ultricies dictum malesuada. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos.">?</span></th>
                  <td>$15</td>
                </tr>
                <tr class="breakdown last">
                  <th>HSRT:</th>
                  <td>$29</td>
                </tr>

                <tr class="main">
                  <th>_total_:</th>
                  <td ng-switch-when="cc">{{getTotal('totalAfterTax') | i18nCurrency: $root.currencyCode}}</td>
                  <td ng-switch-when="point" ng-if="loyaltyProgramEnabled">{{getTotal('pointsRequired')}} _points_</td>
                  <td ng-switch-default>{{getTotal('totalAfterTax') | i18nCurrency: $root.currencyCode}}<span ng-if="loyaltyProgramEnabled && canPayWithPoints"> _or_ {{getTotal('pointsRequired')}} _points_</span></td>
                </tr>
                <tr>
                  <th></th>
                  <td><a class="breakdown-toggle" ng-show="bookingConfig.priceBreakdownExtended" href ng-click="breakdownExtended = !breakdownExtended"><span ng-if="!breakdownExtended">_view_price_breakdown_</span><span ng-if="breakdownExtended">_hide_price_breakdown_</span></a></td>
                </tr>
              </thead>
              <tbody>
                <!-- Additional taxes 
                <tr ng-if="getTotal('totalAdditionalTaxes')">
                  <th>_taxes_:</th>
                  <td>{{getTotal('totalAfterTax') - getTotal('totalBase') | i18nCurrency: $root.currencyCode}}</td>
                </tr>
                -->

                <!-- Additional fees 
                <tr ng-if="getTotal('totalAdditionalFees')">
                  <th>_fees_:</th>
                  <td>{{getTotal('totalAdditionalFees') | i18nCurrency: $root.currencyCode}}</td>
                </tr>
                -->

                <!-- Discount 
                <tr ng-if="getTotal('totalDiscount')">
                  <th>_discount_:</th>
                  <td>{{getTotal('totalDiscount') | i18nCurrency: $root.currencyCode}}</td>
                </tr>
                -->

              </tbody>
            </table>
          </div>

        <div ng-if="state.includes('reservation.confirmation')">
          <label for="agreement1" class="input-checkbox">
            <input type="checkbox" id="agreement1" ng-model="additionalInfo.agree"/>
            _i_agree_to_ <a href ng-click="readPolicies()">_terms_conditions_</a>
          </label>

          <label for="agreement2" class="input-checkbox">
            <input type="checkbox" id="agreement2" ng-model="additionalInfo.optedIn"/>
            _receive_offer_label_
          </label>
        </diV>
        </section>
      </aside>
    </div>

    <label for="agreement3" class="input-checkbox" ng-if="state.includes('reservation.details') || state.includes('reservation.billing')">
      <input type="checkbox" id="agreement3" ng-model="additionalInfo.optedIn"/>
      <i ng-bind-html="'_email_optin_label_' | stringLocaleReplace:chainName"></i>
    </label>

    <div class="reservation-controls" grid-row>
      <button class="back" ng-click="goBack()">_back_</button>
      <button class="next" ng-click="continue()" ng-disabled="isContinueDisabled()">{{continueName}}</button>
      <registration-call ng-if="!isUserLoggedIn() && state.includes('reservation.details') && !isModifyingAsAnonymous()">
        <h4 ng-bind-html="'_reservation_page_loginprompt_title_' | mainHeaderStyle"></h4>
        <p>_click_here_to_ <a href ng-click="sso.login()">_login_register_</a>.</p>
      </registration-call>
    </div>
  </reservation-widget>
</main>
