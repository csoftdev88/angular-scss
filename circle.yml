dependencies:
  # Git requires user.email and user.name configured before git commit can be run.
  pre:
    - git config --global user.email "herokuadmin@salsita.com"
    - git config --global user.name "CircleCI @ Salsita"
  override:
    - npm prune
    - npm install
    - bower prune
    - bower install
  cache_directories:
    - node_modules
    - bower_components

machine:
  environment:
    NODE_ENV: test

test:
  override:
    - grunt test
  post:
    - sed -i -e 's/node_modules//' .gitignore
    - sed -i -e 's/bower_components//' .gitignore
    - sed -i -e 's/\/bin//' .gitignore
    - sed -i -e 's/build//' .gitignore
    - git add -A
    - git commit -m "build"

deployment:
  try:
    branch: /try.*/
    commands:
      - git push -f git@heroku.com:mobius-try.git ${CIRCLE_SHA1}:refs/heads/master
  dev:
    branch: develop
    commands:
      - git push -f git@heroku.com:mobius-dev.git ${CIRCLE_SHA1}:refs/heads/master
  qa:
    branch: /release\/.+/
    commands:
      - git push -f git@heroku.com:mobius-qa.git ${CIRCLE_SHA1}:refs/heads/master
  client:
    branch: client
    commands:
      - git push -f git@heroku.com:mobius-client.git ${CIRCLE_SHA1}:refs/heads/master
  prod:
    branch: master
    commands:
      - git push -f git@heroku.com:mobius-prod.git ${CIRCLE_SHA1}:refs/heads/master
